<!DOCTYPE html>
<html>
<head>
  <title>Messages</title>
  <link rel="stylesheet" href="/css/messages.css" />
</head>
<body>
  <%- include('partials/header') %>

  <main>
    <div class="contentHeader">
      <h1>Message Board</h1>
      <p>
        Welcome, <%= user.firstname || user.username %>!
        <form action="/logout" method="POST">
          <button type="submit">Logout</button>
        </form>
      </p>
    </div>
    <div class="postContainer">
      <h2>Post a message</h2>
      <form action="/messages" method="POST">
        <input type="text" name="message" maxlength="255" required>
        <button type="submit">Send</button>
      </form>
    </div>
    <content>
      <% if (messages && messages.length) { %>
          <% messages.forEach(msg => { %>
            <div class="messageContainer">
              <img src="<%= msg.avatar_url || '/img/default-avatar.svg' %>" alt="Avatar" class="postAvatar"/>
              <div class="messageInfo">
                <p><strong><%= msg.firstname %> <%= msg.lastname %>:</strong></p>
                <p><%= msg.message %></p>
                <p class="timestamp"><small>(<%= new Date(msg.created_at).toLocaleString() %>)</small></p>
                <% if (user.role_id === 3) { %>
                  <form action="/messages/<%= msg.id %>/delete" method="POST" id="deleteForm">
                    <button type="submit">Delete</button>
                  </form>
                <% } %>
              </div>
              </div>
          <% }) %>
      <% } else { %>
        <p>No messages yet.</p>
      <% } %>
    </content>
  </main>
</body>
</html>
